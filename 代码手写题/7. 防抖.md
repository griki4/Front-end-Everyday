## 防抖

防抖的通俗解释：事件的回调函数在事件触发N秒后才会执行，如果N秒内再次触发相同事件，则会重新计时。

在监听输入框，计算页面滚动等场景中都有防抖函数的应用。

从上面的解释就能看出手写防抖函数的一些要点。首先是参数，需要接收一个事件触发时执行的回调函数以及一个定义延迟执行时间长短的参数。注意，防抖函数的调用方式是debounce(fun, delay)，而被包含在防抖函数内部的事件回调函数一般是需要在事件触发时才执行而非跟着防抖函数执行。**因此，防抖函数的返回值应该是一个函数，内部包含了事件真正的回调函数。**

既然提及到延迟执行，就必然涉及定时器的定义和清除。详细代码如下：

```javascript
function debounce(fun, delay){
    //在返回函数的外部定义一个记录定时器的变量
    //在外部是因为该变量只用创建一次，后面都是赋值操作。由于闭包的存在，防抖函数执行完毕该变量也不会被销毁。
    let timer = null
    return function () {
        //触发事件则清除上一个定时器
        clearTimeout(timer)
        //从新开启定时器
        //定时器内部采用箭头函数的原因，是因为需要让事件回调函数的this指向事件触发的对象
        //返回的函数正是被事件触发对象调用的，它的this就是指向事件触发对象的
        timer = setTimeout(() => {
            fun.apply(this, arguments)
        },delay)
    }
}
```

这里保证fun的this指向的方式是使用箭头函数，如果要使用普通函数，则需要用变量记录下this和参数arguments然后将变量作为apply的参数。