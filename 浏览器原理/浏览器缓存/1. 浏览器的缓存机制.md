## 浏览器缓存机制

[图片来源](https://juejin.cn/post/6916157109906341902#heading-22)

![业务流程图1.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f6837d8d1c74cf2894d8967a20115d9~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

浏览器缓存，缓存的是资源文件以及响应头。按照上述流程图，第二次请求的流程就是。

1. 比较当前时间和上一次返回的资源的时间差与响应头中的`Cache-control`中设置的资源过期时间的大小。小于过期时间则命中强缓存，说明资源依然有效，直接读取本地缓存即可。
2. 大于过期时间说明资源过期。浏览器会创建一个`if-None-Match`和`if-Modified-Since`信息的请求发送至服务器。
3. 请求有`Etag`值，服务器直接比较这个`Etag`值和当前服务器对应资源的`Etag`值，一致则命中协商缓存，返回304浏览器直接读取本地缓存。不一致说明资源有更新，返回新的资源文件和`Etag`值，并带上状态码200。
4. 如果没有`Etag`值，则比较`if-Modified-Since`和服务器对应资源最后一次被修改的时间，一致则命中协商缓存，返回304浏览器读取本地缓存，不一致则说明资源更新，返回新的资源文件和`last-Modifined`。

上述就是浏览器的基本缓存机制的流程。