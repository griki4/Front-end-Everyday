## 渲染优化

### 1.JavaScript阻塞页面解析的原因和解决方法。

#### JS阻塞页面解析的原因

浏览的渲染进程中，GUI渲染线程和JS引擎是互斥的关系，因为JS可能会操作DOM，两个线程同时执行会导致渲染线程前后获得的元素数据不一致，发生冲突。JS引擎执行的时候，GUI线程会被挂起等待执行，直到JS代码执行完毕，这个过程中页面就会停止解析。

如果JS代码执行的时间过长就会导致页面加载阻塞时间长，影响用户体验。

#### 优化方法

- JS代码的引入最好是放在body标签的最后。
- 尽量使用异步加载的方式来加载JS文件，比如defer和async方法。

### 2.CSS会阻塞页面解析的原因和解决方法。

#### 原因

严格来说，CSSOM的构建和DOM树的构建之间并无直接关联，因此CSS应该不会阻塞文档解析。但是JS的存在可能改变这一情况，JS在执行过程中可能存在请求样式信息的行为，如果此时样式文件还未加载，那么JS就会等待样式文件加载之后再执行。这就是CSS阻塞文档解析的原因。

#### 优化

- 尽量使用link而非@import引入CSS文件。link会单独派发一个http线程去加载资源文件，GUI线程继续往下执行。而@import方法会暂停GUI渲染线程，去服务器请求资源，资源返回之前GUI线程一直处于暂停状态。

**外部样式长时间没有加载完毕，浏览器会先使用默认样式渲染页面，确保首次渲染速度。因此CSS一般放在header中让浏览器尽快请求CSS文件。**

### 3.DOM，CSSOM

- HTML代码的层级不要太深
- 使用语义化的标签
- CSS的层级不要太多，选择器的解析是从左至右的

### 4.减少回流和重绘

回流是指DOM元素的大小发生改变，渲染进程需要从布局阶段开始重新计算布局并绘制页面。

重绘是指元素的颜色等不影响大小的信息变化的时候，渲染过程重新进入绘制过程渲染页面。

- 批量操作DOM。让元素脱离标准文档流对其进行多次修改，然后将其返回文档流。
- 切换样式使用修改类名而不是直接操作样式的方式。
- 避免强制同步布局。获取某些元素的样式信息会导致浏览器强制刷新队列。
- 避免使用table布局。一个table中元素的改变可能导致整个table元素重新布局。？
- CSS3硬件加速。动画是在渲染进程中的合成线程上进行的，不影响主线程执行。不过这玩意儿也有坑，用多了会导致内存开销巨大，其次就是CPU和GPU的算法不同会导致使用GPU加速是抗锯齿无效，所以用完记得关一下。transform、opacity、filters、Will-change可以触发硬件加速。 