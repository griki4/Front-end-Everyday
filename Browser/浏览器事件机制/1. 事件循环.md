## 事件循环

事件对象`event`是`js`中一个非常重要的概念，关于事件在红宝书中甚至单独列出一章进行阐述，包含`DOM`事件流，事件委托等相关知识，建议仔细看一遍理解相关概念。

这里主要说一下浏览器中的事件循环机制。众所周知`js`遵循祖宗之法不可变的原则，一直都是单线程执行的，但是随着`web`功能的逐渐丰富，单线程的执行机制就出现问题了。比如一张图片在网页中加载的时间比较长，难道要等到它加载完毕才执行后面的代码，未免有点膈应了。在这个基础上提出了异步和事件循环。

比如我们给图片加载完毕这个事件绑定一个回调函数，然后先执行后面的代码，后面的代码执行完了，再执行绑定的回调函数。图片加载完毕就是一个异步事件。

异步事件的回调函数会被放入任务队列中等待执行。任务队列又分为宏任务和微任务。一个完整的`Event Loop`的执行流程如下

- 执行同步代码，也就是第一轮宏任务。
- 同步代码执行完毕，查看微任务队列并执行微任务。
- 微任务队列为空，查看宏任务队列，执行下一个宏任务，也就是开启下一轮循环。

两个值得注意的点：

1. 宏任务在执行过程中可能会产生微任务，但是主线程依旧会把当前宏任务执行完毕而不是停下来去执行微任务。
2. 宏任务的开始执行就是一轮事件循环开始的标志，理解这个思想可以解决很多的异步代码输出题（个人觉得有效）。

常见的宏任务和微任务

宏任务：`setTimeOut`，`setInterval`，`ajax`等

微任务：`promise`的回调（`promise`的执行器函数是同步执行的），`mutation observer`



